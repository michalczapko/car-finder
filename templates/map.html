<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDheh_MoqgYwsq5iohF93lnCvHZkuKQoYg&sensor=false">
    </script>
    <script type="text/javascript" src="/static/src/infobox.js"></script>
    <script type="text/javascript">
      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(53.5686, 10.0386),
          zoom: 13,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);

        var latlng;

        var full_icon = '/static/car2go_blue.png';
        var empty_icon = '/static/car2go_red.png';

        {% for car in cars %}
            // latlng = new google.maps.LatLng({{ car['coordinates'][1] }}, {{ car['coordinates'][0] }});
            // map.addOverlay(new google.maps.Marker(latlng));

            marker = new google.maps.Marker({
                position: new google.maps.LatLng({{ car['coordinates'][1] }}, {{ car['coordinates'][0] }}),
                map: map,
            {% if car['fuel'] > 25 %}
                icon: full_icon
            {% else %}
                icon: empty_icon
            {% endif %}
            });

            var boxText = document.createElement("div");
            boxText.style.cssText = "border: 1px solid black; margin-top: 8px; background: white; padding: 5px;";
            // boxText.innerHTML = '%s <br> %s <br> %s' % "{{ car['address'] }}, {{ car['name'] }}, {{ car['fuel'] }}";
            
            boxText.innerHTML = '{{' %s ' % car['address'] }}' + '<br> Fuel' + '{{ ' %s ' % car['fuel'] }}' + '%'

            var myOptions = {
                content: boxText
                ,disableAutoPan: false
                ,maxWidth: 0
                ,pixelOffset: new google.maps.Size(-140, 0)
                ,zIndex: null
                ,boxStyle: { 
                background: "url('tipbox.gif') no-repeat"
                ,opacity: 0.75
                ,width: "280px"
            }
            ,closeBoxMargin: "10px 2px 2px 2px"
            ,closeBoxURL: "http://www.google.com/intl/en_us/mapfiles/close.gif"
            ,infoBoxClearance: new google.maps.Size(1, 1)
            ,isHidden: false
            ,pane: "floatPane"
            ,enableEventPropagation: false
            };

            var ib = new InfoBox(myOptions);

            google.maps.event.addListener(marker, "click", function (e) {
              ib.open(map, this);
            });            

        {% endfor %}


      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
    <div id="map-canvas"/>
  </body>
</html>